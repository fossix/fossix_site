{% extends 'base.html' %}

{% from 'utils.html' import print_author, tag_detail %}
{% from "utils.html" import render_field, field_errors %}

{% set pagetitle=content.title %}

{% block content %}
<div class="contenthead">
  By
  {% if content.author %}
  <a href="#">{{ print_author(content.author) }}</a>
  {% else %}
  Anonymous
  {% endif %}
  on
  {{ content.get_create_date() }} {% if g.user.is_authenticated() and g.user.is_editor(content) %}
  <a href="{{ url_for('content.EditView:get', id=content.id) }}" id="edit">
    <button class="btn btn-mini"><i class="icon-edit"> </i></button></a>
  {% endif %}
  <span class="badge badge-inverse pull-right" id="likecount">
    {{content.like_count}}
  </span>
  <a href="{{ url_for('content.ContentView:vote', id=content.id, vote='up') }}"
     class="pull-right" id="like">
    <button class="btn btn-mini"><i class="icon-thumbs-up"> </i>Like</button>
  </a>
</div>

<div class="content-body">
  {{ content.content | markdown }}
</div>

<div class="span12">
<div class="taglist pull-left">
  {% for t in content.tags %}
    {{ tag_detail(t) }}
  {% endfor %}
</div>

{% if g.user.is_authenticated() %}
<div class="read-count pull-right">
  Number of reads: {{ content.read_count }}
</div>
{% endif %}
</div>

<div class="span12">
<div class="pull-right">
{% if content.version > 1 %}
<a href="#" data-toggle="tooltip" class="tip"
   title="Version {{content.version}}: {{content.edit_summary}}">
  Modified {{content.modified_date | relative_now}} ago
</a>
by
  {{ print_author(content.author) }}
{% endif %}
</div>
</div>
<hr>
<form method="POST" id="comment_form">
  {{ comment.hidden_tag() }}
  {{ render_field(comment.content, rows=4, required=True, class="span12") }}
  <input type="submit" value="Comment" name="submit" formaction="{{request.path}}">
</form>
<hr>
{% if content.comments %}
{%- for comment in content.comments recursive %}
<div>
  <div class="media">
    <div class="pull-left tooltips"
       title="{{g.user.username}}" data-toggle="tooltip"
       data-placement="top">
      <img class="media-object" src="{{g.user.avatar(64)}}" />
    </div>
    <div class="media-body">
      {% if comment.title %}
        <h4 class="media-heading">{{comment.title}}</h4>
      {% endif %}
      {{ comment.content }}
        <div class="clear-fix">
          <span class="badge badge-inverse pull-left"
                       id="vote_count{{comment.id}}">
            {{comment.like_count}}
          </span>
          <div class="pull-left">
            <a href="#" data-url="{{ url_for('content.ContentView:vote',
                                  id=comment.id, vote='up') }}"
               class="vote" id="{{comment.id}}">
              <i class="icon-thumbs-up"> </i>
            </a>
            <br>
            <a href="#" data-url="{{ url_for('content.ContentView:vote',
                                  id=comment.id, vote='down') }}"
               class="vote" id="{{comment.id}}">
              <i class="icon-thumbs-down"> </i>
            </a>
          </div>
          <a href="#" class="pull-right">Reply</a>
        </div>
        {%- if comment.comments -%}
        {{ loop(comment.comments) }}
        {%- endif %}
    </div>
  </div>
</div>
{%- endfor %}
{% endif %}
{% endblock %}
